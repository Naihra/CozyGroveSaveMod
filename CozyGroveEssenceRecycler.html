<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Cosy Grove Essence Recycler</title>
	<style type="text/css">
		a,label,input {		
		font-family: 'Courier New', monospace;		
		margin: 5px;
		}
	</style>
	<script src="./data/function.js"></script>
</head>

<body>

	<h1>Cozy Grove Essence Recycler</h1>	
	
	<label for="uploadSourceFile">Select your save</label><br>
	<input id="uploadSourceFile" type="file" accept=".sf">
	<br><br>

	<img src="./data/memory_2_bird.jpg" alt="Happy bird essence" width="100" height="100" >
	<input id="out_bird2" type="int" size="2" disabled="true"> 

	<img src="./data/memory_2_deer.jpg" alt="Happy deer essence" >
	<input id="out_deer2" type="int" size="2" disabled="true"> 
	
	<img src="./data/memory_2_imp.jpg" alt="Happy imp essence" >
	<input id="out_imp2" type="int" size="2" disabled="true"> 
	<br>
	
	<img src="./data/memory_3_bird.jpg" alt="Joyous bird essence" >
	<input id="out_bird3" type="int" size="2" disabled="true"> 

	<img src="./data/memory_3_deer.jpg" alt="Joyous deer essence" >
	<input id="out_deer3" type="int" size="2" disabled="true"> 
	
	<img src="./data/memory_3_imp.jpg" alt="Joyous imp essence" >
	<input id="out_imp3" type="int" size="2" disabled="true"> 
	<br>
	
	<input id="bt_recycle" type="button" value="Recycle" onclick="recycle();" disabled ="true">
	<br><br>

	<script>
	
	document.getElementById("uploadSourceFile").addEventListener("change", loadSource, false);
	
	function start( result )
	{
		if ( result )
		{
			readInventory();
		}
	}
	
	function readInventory()
	{	
		var wl_bird2 = 0;
		var wl_deer2 = 0;
		var wl_imp2  = 0;
		var wl_bird3 = 0;
		var wl_deer3 = 0;
		var wl_imp3  = 0;
		
		for (var key in json.Player.Inventory.SlotDisplayOrder)
		{
			var line = json.Player.Inventory.SlotDisplayOrder[key];
			
			if (line != null ) {
			switch ( line.item.configID.Value ) {
				case 'memory_2_bird':
					wl_bird2 += line.amount;
					break;
				case 'memory_2_deer':
					wl_deer2 += line.amount;
					break;
				case 'memory_2_imp':
					wl_imp2 += line.amount;	
					break;
				case 'memory_3_bird':
					wl_bird3 += line.amount;
					break;
				case 'memory_3_deer':
					wl_deer3 += line.amount;
					break;
				case 'memory_3_imp':
					wl_imp3 += line.amount;	
					break;
			} }				
		}
		
		document.getElementById("out_bird2").value = wl_bird2;
		document.getElementById("out_deer2").value = wl_deer2;
		document.getElementById("out_imp2").value  = wl_imp2;	
		document.getElementById("out_bird3").value = wl_bird3;
		document.getElementById("out_deer3").value = wl_deer3;
		document.getElementById("out_imp3").value  = wl_imp3;
					
		if ( wl_bird2 != 0 || wl_deer2 != 0 || wl_imp2 != 0 || wl_bird3 != 0 || wl_deer3 != 0 || wl_imp3 != 0 )
		{			
			document.getElementById("bt_recycle").disabled = false;				
		}
		else
		{
			document.getElementById("bt_recycle").disabled = true;
		}
	}	

	function recycle() {		
	
			document.getElementById("bt_recycle").disabled = true;
	
			for (var key in json.Player.Inventory.SlotDisplayOrder)
			{
				var line = json.Player.Inventory.SlotDisplayOrder[key];
				
				const factor = 3;
				
				if (line != null ) {
				switch ( line.item.configID.Value ) {
					case 'memory_2_bird':
						line.amount *= factor;
						line.item.configID.Value = "memory_1_bird";						
						break;
					case 'memory_2_deer':
						line.amount *= factor;
						line.item.configID.Value = "memory_1_deer";
						break;
					case 'memory_2_imp':
						line.amount *= factor;
						line.item.configID.Value = "memory_1_imp";
						break;
					case 'memory_3_bird':
						line.amount *= factor;
						line.item.configID.Value = "memory_2_bird";
						break;
					case 'memory_3_deer':
						line.amount *= factor;
						line.item.configID.Value = "memory_2_deer";
						break;
					case 'memory_3_imp':
						line.amount *= factor;
						line.item.configID.Value = "memory_2_imp";
						break;
				} }			
			}
			
			save( JSON, true );	
	}
	</script>
</body>
</html>